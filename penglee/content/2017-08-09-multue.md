Title: Multue测试工具介绍
Date:2017-08-19
Author:李鹏
Slug: Multue
Tags: Multue
category:自动化测试工具

### 基本介绍

  本文介绍了本人前段时间开发的基站多UE的业务测试工具。

### 制作目的

  基站产品开发过程中，会对基站的业务性能及稳定性进行测试。该测试项目在每个迭代版本中进行多次验证测试。测试环境比较复杂，涉及多个UE（比如32、96甚至更多).测试时需要对多个CPE进行业务传输测试。
测试过程中，还需要关注基站的状态、UE的状态、业务传输速率等指标。该测试一般持续比较长的时间如7*24H，单纯靠人工测试，比较浪费人力和精力。因此在此需求上开发了Multue的自动化测试工具。

### 支持功能

该工具主要支持以下功能：

* 1． 支持多UE（96UE，可扩展）进行FTP上传/下载业务测试；
* 2． 支持测试时长设定，测试过程中，因UE或基站异常造成业务中断，环境恢复后，业务可以自动恢复（支持常用的排错处理）；
* 3． 支持定制UE进行业务测试，支持指定UE进行上传/下载业务；
* 4． 支持业务测试和监控分离，可以只进行测试或只进行监控
      监控内容包括：基站监控状态监控和UE监控，具体见下文。


### 简单实现说明

  该工具的实现主要包括：

#### 1. 业务测试部分

    由python ftp库进行文件的上传下载

#### 2. 监控部分

    通过ssh库登录基站后台，进行数据的抓取，分别将数据写入log文件和db文件；

#### 3. 控制部分

基站相关信息保存在xml文件中，主程序从xml文件读取CPE的imsi、ip、ftpip、下载或上传路径等参数。测试设置由主窗口进行设定，由pyqt实现，具体参见代码。

### How to

使用方法如下：涉及产品信息，只做基本介绍。

####　1．测试环境搭建
　　　　
该部分由测试人员设定。

环境要求：
基站设置为待测环境（如LGW模式、时隙配比等）；
CPE已附着，设置相关路由使测试控制机通过指定CPE连接到FTP。

#### 2．测试参数设置

测试相关设置参数主要保存在args.xml文件中。

#### 3．测试执行

直接双击执行“Run.exe“执行程序(可以编译成可执行文件，减少环境依赖，增加通用性)，同样，开始时后台会进行一些文件的初始化及环境初始化的工作。然后出现以下窗口：


<img src="https://github.com/king32783784/king32783784.github.io/blob/master/tmpfile/mute01.png?raw=true" height="320" width="480">

该窗口第一个标签窗口，列出了配置文件中96UE的IMSI。可以在UE列表中勾选要进行测试的UE，默认进行下载业务，可以更改对应UE的业务模式，目前只支持UL/DL两种。选择UE及相应业务模式后，输入测试时间。另外点击全选，可以直接选中前32个UE，然后点击启动测试按钮，后台便开始进行相应的测试业务。
点击“监控设置“标签，可以切换到监控设置界面。如下图：

<img src="https://github.com/king32783784/king32783784.github.io/blob/master/tmpfile/mute02.png?raw=true" height="320" width="480">

该界面列出了目前支持的监控类型，可以根据需要选择监控项目，直接勾选对应的监控类型即可。勾选完成后，点击启动监控，此时后台便开始进行相应的监控。生成的对于监控记录保存Result目录中对应的文件中。如果想实时查看监控信息，可以点击“查看监控“，可以弹出如下窗口：


<img src="https://github.com/king32783784/king32783784.github.io/blob/master/tmpfile/mute03.png?raw=true" height="320" width="480">

该窗口会将支持的监控类型全部显示出来，但监控设置中未选中的部分不会进行实时更新。和单UE测试工具一样，该监控信息也是在一定时间间隔下进行更新。
监控和测试已分开控制，所以支持只进行监控。

### Todo List

* 1.UI可以进行优化和完善，如将配置信息以UI形式进行设置等；
* 2.测试前设置如基站相关的模式设置等，可以添加；
* 3.告警功能，自动发送邮件、语音提示相关的代码已实现，但处于注销或未集成状态，明确告警条件后，可以添加；
* 4.业务模型的扩展，根据测试需求增加测试时段设置、版本变更自动触发测试等功能。

### 项目地址

[MultiueTest](https://github.com/king32783784/MultiueTest.git)

目前该工具仍投入生产环境中使用，但仍然存在一些问题和需改进优化的地方，欢迎大家提出发现的bug和建议。谢谢：
